"use strict";let delay=400,deck=new Deck,dealer=new Dealer("Dealer","dealer"),sound=new Sound,ambient=new Audio("assets/sounds/ambient/01.mp3");ambient.volume=.1;let roundOver=!1,firstRound=!0,playersAll=[],playersNotDealer=[],playersAi=[],playersPlayer=[],slotsPlayer=0,slotsAi=0,amountDecks=0,cash=0,swearing="";function allowDrop(e){e.preventDefault()}function drag(e){e.dataTransfer.setData("text",e.target.id),e.dataTransfer.effectAllowed="copy"}function drop(e){e.preventDefault();let t=e.dataTransfer.getData("text"),l=document.createElement("img"),a=document.getElementById(t);l.src=a.src,l.classList=a.classList,l.classList.add("betPlayers__chip--active"),l.classList.add(t),"IMG"===e.target.tagName?e.target.parentElement.appendChild(l):e.target.appendChild(l),sound.chip()}function sliderMain(e){let t=parseInt(document.getElementById("slotsPlayer").value),l=parseInt(document.getElementById("slotsAi").value);if(t+l>7&&"player"==e?document.getElementById("slotsAi").value=7-t:t+l>7&&"ai"==e&&(document.getElementById("slotsPlayer").value=7-l),0==l&&0==t&&"player"==e?document.getElementById("slotsAi").value=1:0==l&&0==t&&"ai"==e&&(document.getElementById("slotsPlayer").value=1),document.getElementById("slotsAiValue").innerHTML=document.getElementById("slotsAi").value,document.getElementById("slotsPlayerValue").innerHTML=document.getElementById("slotsPlayer").value,"cash"==e)document.getElementById("amountCashValue").innerHTML=document.getElementById("amountCash").value;else if("decks"==e)document.getElementById("amountDecksValue").innerHTML=document.getElementById("amountDecks").value;else if("speed"==e){let a=document.getElementById("gameSpeed").value;switch(a){case"1":delay=1200;break;case"2":delay=800;break;case"3":delay=400;break;case"4":delay=200;break;case"5":delay=100}}else if("swearing"==e){let s=document.getElementById("swearing").value;"0"==s?swearing="":"1"==s?swearing="normal":"2"==s&&(swearing="strong")}else if("music"==e){let n=document.getElementById("musicVolume").value/10;ambient.volume=n}}function resetBets(e){if(!0==e||!1!=roundOver){for(let t=0;t<playersPlayer.length;t++){let l=document.getElementById("betPlayer"+t);l.innerHTML="",l.setAttribute("ondrop","drop(event)"),l.setAttribute("ondragover","allowDrop(event)")}for(let a of playersPlayer)a.bet=0}}function resetBetfields(){for(let e=0;e<7;e++){let t=document.getElementsByClassName("betPlayer"+e);t[0].innerHTML="",t[0].removeAttribute("ondrop","drop(event)"),t[0].removeAttribute("ondragover","allowDrop(event)"),t[0].id="betPlayer"+e,t[0].classList.contains("betPlayers--active")&&t[0].classList.toggle("betPlayers--active")}}async function repeatRound(){if(!1==roundOver)return;for(let e=0;e<7;e++)document.getElementsByClassName("betPlayer"+e)[0].innerHTML="";let t=0;for(let l of playersPlayer)t+=l.lastBet;if(!(t<=cash))return console.log("Not enough cash."),writeInfo("Not enough cash."),"Not enough cash.";for(let a of playersPlayer)for(let s of a.betSaved)document.getElementById("bet"+a.name).append(s);newRound()}function toggleMenu(){document.getElementById("menu").classList.toggle("menu"),document.getElementById("menu").classList.toggle("menu--active"),document.getElementById("field").classList.toggle("field"),document.getElementById("field").classList.toggle("field--active")}function writeInfo(e){let t=document.getElementById("field__header__info");t.innerHTML=e,t.classList.toggle("field__header__info--active"),setTimeout(function(){t.classList.toggle("field__header__info--active")},3e3)}function newGame(){ambient.play(),firstRound=!0,console.clear(),toggleMenu(),document.getElementById("fieldDealer").innerHTML="";for(let e=0;e<7;e++)document.getElementById("fieldPlayer"+e).innerHTML="";if(resetBets(!0),resetBetfields(),playersAll=[],playersNotDealer=[],playersAi=[],playersPlayer=[],slotsPlayer=parseInt(document.getElementById("slotsPlayer").value),slotsAi=parseInt(document.getElementById("slotsAi").value),amountDecks=parseInt(document.getElementById("amountDecks").value),cash=parseInt(document.getElementById("amountCash").value),amountDecks<1||slotsPlayer<1&&slotsAi<1)return;for(let t=0;t<slotsPlayer;t++){let l=new Player("Player"+t,"player");playersPlayer.push(l),playersAll.push(l),playersNotDealer.push(l)}for(let a=0;a<slotsAi;a++){let s=new Ai("Ai"+a,"ai");playersAi.push(s),playersAll.push(s),playersNotDealer.push(s)}playersAll.unshift(dealer);for(let n=0;n<playersPlayer.length;n++){let r=document.getElementsByClassName("betPlayer"+n);r[0].setAttribute("ondrop","drop(event)"),r[0].setAttribute("ondragover","allowDrop(event)"),r[0].classList.contains("betPlayers--active")||r[0].classList.toggle("betPlayers--active")}document.getElementById("buttonNewRound").classList.add("fieldChips__buttons__newRound"),document.getElementById("buttonNewRound").classList.remove("fieldChips__buttons__newRound--active"),document.getElementById("buttonResetBets").classList.add("fieldChips__buttons__resetBets"),document.getElementById("buttonResetBets").classList.remove("fieldChips__buttons__resetBets--active"),document.getElementById("buttonRepeatRound").classList.add("fieldChips__buttons__repeatRound"),document.getElementById("buttonRepeatRound").classList.remove("fieldChips__buttons__repeatRound--active"),document.getElementById("buttonNewRound").classList.toggle("fieldChips__buttons__newRound"),document.getElementById("buttonNewRound").classList.toggle("fieldChips__buttons__newRound--active"),0!=playersPlayer.length&&(document.getElementById("buttonResetBets").classList.toggle("fieldChips__buttons__resetBets--active"),document.getElementById("buttonResetBets").classList.toggle("fieldChips__buttons__resetBets"));let o=document.getElementById("renderCash");7==playersAi.length?o.innerHTML="":o.innerHTML=cash,roundOver=!0}async function newRound(){if(!roundOver)return;let e;for(let t=0;t<playersPlayer.length;t++)if(""==(e=document.getElementsByClassName("betPlayer"+t))[0].innerHTML)return console.log("Place your bets."),writeInfo("Place your bets."),"Place your bets.";let l=0;for(let a of playersPlayer)l+=a.getBet(!0);if(console.log("   Sum bets: "+l),l>cash)return console.log("Not enough cash."),writeInfo("Not enough cash."),"Not enough cash.";for(let s=0;s<7;s++)(e=document.getElementsByClassName("betPlayer"+s))[0].removeAttribute("ondrop"),e[0].removeAttribute("ondragover");for(let n of(document.getElementById("buttonNewRound").classList.toggle("fieldChips__buttons__newRound--active"),document.getElementById("buttonNewRound").classList.toggle("fieldChips__buttons__newRound"),0!=playersPlayer.length&&(document.getElementById("buttonResetBets").classList.toggle("fieldChips__buttons__resetBets--active"),document.getElementById("buttonResetBets").classList.toggle("fieldChips__buttons__resetBets"),!1==firstRound&&(document.getElementById("buttonRepeatRound").classList.toggle("fieldChips__buttons__repeatRound--active"),document.getElementById("buttonRepeatRound").classList.toggle("fieldChips__buttons__repeatRound"))),roundOver=!1,playersAll))n.reset();for(let r=0;r<playersNotDealer.length;r++){let o=document.getElementById("fieldPlayer"+r);!1==firstRound&&sound.clear();let i=1;do i-=.025,o.style.opacity=i.toString(),await sleep(1);while(i>0)}let d=document.getElementById("fieldDealer"),u=1;do u-=.02,d.style.opacity=u.toString(),await sleep(1);while(u>0);firstRound=!1,document.getElementById("fieldDealer").innerHTML="";for(let y=0;y<7;y++)document.getElementById("fieldPlayer"+y).innerHTML="";for(let g=0;g<playersNotDealer.length;g++)document.getElementById("fieldPlayer"+g).style.opacity="1";d.style.opacity=1,deck.deck=[],deck.getDeck(amountDecks);let c=0;for(let f of playersAll)f.createPlayer(c),"dealer"!=f.type&&c++;for(let p of playersNotDealer){let m=p.getCard();p.renderCard(m,p.name),await sleep(delay)}let h=dealer.getCard();for(let B of(dealer.renderCard(h,dealer.name),await sleep(delay),playersNotDealer)){let b=B.getCard();B.renderCard(b,B.name),await sleep(delay)}for(let v of(dealer.getCoveredCard(),dealer.renderCard("covered",dealer.name),await sleep(4*delay),dealer.checkHand(),playersPlayer))v.addButtons();for(let $ of playersAi)$.checkHand();for(let E of playersPlayer)"Black Jack!"==E.checkHand()&&(E.removeButtons(),E.isAlive);for(let R of playersAll){let I=document.getElementById("result"+R.name);I.innerHTML=R.totalValue,I.classList.toggle("fieldPlayers__container__totalValue__text--active")}for(let w of playersPlayer)if(!0==w.isAlive)return;playAi()}async function buttonHit(e){if(!roundOver){for(let t of(document.getElementById("buttonHit"+e).setAttribute("onclick",""),playersPlayer))if(t.name==e){if(!t.isAlive)return;console.log(t.name+": Hit"),t.soundHit(),await sleep(4*delay);let l=t.getCard();t.renderCard(l,t.name),await sleep(delay);let a=t.checkHand();if("Card?"!=a||!0==t.doubled){for(let s of(t.removeButtons(),t.isAlive=!1,playersPlayer))if(!0==s.isAlive)return;playAi()}return document.getElementById("buttonHit"+e).setAttribute("onclick","buttonHit('"+e+"')"),t.removeButtons(!0),a}}}async function buttonStand(e){if(!roundOver){for(let t of playersPlayer)if(t.name==e){if(!t.isAlive)return;console.log(t.name+": Stand"),t.renderResult("Stand"),t.isAlive=!1,t.removeButtons();break}for(let l of playersPlayer)if(!0==l.isAlive)return;playAi()}}function buttonSplit(e){writeInfo("Not implemented yet :D")}async function buttonDouble(e){for(let t of playersPlayer)if(t.name==e){if(!t.isAlive)return;let l=0;for(let a of playersPlayer)a.name!=e&&(l+=a.getBet(!1));if(cash<2*t.getBet(!1)+l)return console.log("Not enough cash."),writeInfo("Not enough cash."),"Not enough cash.";{let s=document.getElementById("bet"+e).querySelectorAll(".fieldChips__container__chip__img"),n=document.getElementById("bet"+e);for(let r of(console.log(s),s)){let o=document.createElement("img");o.src=r.src,o.classList=r.classList,n.append(o)}t.doubled=!0,t.renderResult("Double"),await sleep(4*delay),buttonHit(t.name)}}for(let i of playersPlayer)if(!0==i.isAlive)return;playAi()}async function playAi(){for(let e of(await sleep(4*delay),playersAi)){document.getElementById("result"+e.name).classList.toggle("fieldPlayers__container__totalValue__text--focus");let t;do if("Hit"==(t=e.basicStrategy())){await sleep(4*delay),e.soundHit(),await sleep(4*delay);let l=e.getCard();e.renderCard(l,e.name),await sleep(2*delay),e.checkHand(swearing),await sleep(2*delay)}else e.totalValue<21&&"Stand"==t&&(await sleep(4*delay),e.renderResult(t));while("Hit"==t);await sleep(4*delay),document.getElementById("result"+e.name).classList.toggle("fieldPlayers__container__totalValue__text--focus")}playDealer()}async function playDealer(){document.getElementById("result"+dealer.name).classList.toggle("fieldPlayers__container__totalValue__text--focus"),await sleep(2*delay);let e=document.getElementById("cards"+dealer.name);e.removeChild(e.childNodes[2]);let t=dealer.uncoverCard();dealer.renderCard(t,dealer.name),dealer.checkHand(),await sleep(4*delay);let l;do if("Hit"==(l=dealer.dealerPlay())){let a=dealer.getCard();dealer.renderCard(a,dealer.name),await sleep(2*delay),dealer.checkHand(),await sleep(2*delay)}while("Hit"==l);for(let s of playersAll)console.log("   "+s.name+": "+s.totalValue+"\n");roundOver=!0,await sleep(4*delay),document.getElementById("result"+dealer.name).classList.toggle("fieldPlayers__container__totalValue__text--focus"),checkResult()}async function checkResult(){for(let e of playersNotDealer)21==dealer.totalValue?2==dealer.hand.length?21==e.totalValue?2==e.hand.length?(e.setResult("standoff"),e.renderResult("Stand off")):(e.setResult("lost"),e.renderResult("Lost")):e.totalValue<21&&(e.setResult("lost"),e.renderResult("Lost")):dealer.hand.length>2&&(21==e.totalValue?e.hand.length>2&&(e.setResult("standoff"),e.renderResult("Stand off")):e.totalValue<21&&(e.setResult("lost"),e.renderResult("Lost"))):dealer.totalValue<21?21==e.totalValue&&e.hand.length>2?(e.setResult("won"),e.renderResult("Win")):e.totalValue==dealer.totalValue?(e.setResult("standoff"),e.renderResult("Stand off")):e.totalValue<21&&e.totalValue>dealer.totalValue?(e.setResult("won"),e.renderResult("Win")):e.totalValue<21&&e.totalValue<dealer.totalValue&&(e.setResult("lost"),e.renderResult("Lost")):e.totalValue<21?(e.setResult("won"),e.renderResult("Win")):21==e.totalValue&&e.hand.length>2&&(e.setResult("won"),e.renderResult("Win"));cashUp()}async function cashUp(){let e=0;for(let t of playersPlayer){t.getBet(!1);let l=t.cashUp();console.log(l),cash+=l,e+=l}let a=document.getElementById("renderCash");console.log(cash),playersAi.length<7&&(a.innerHTML=cash),await sleep(4*delay),e>0&&sound.cashUp(),resetBets(!0),cash>0&&(document.getElementById("buttonNewRound").classList.toggle("fieldChips__buttons__newRound--active"),document.getElementById("buttonNewRound").classList.toggle("fieldChips__buttons__newRound"),0!=playersPlayer.length&&(document.getElementById("buttonResetBets").classList.toggle("fieldChips__buttons__resetBets--active"),document.getElementById("buttonResetBets").classList.toggle("fieldChips__buttons__resetBets"),!1==firstRound&&(document.getElementById("buttonRepeatRound").classList.toggle("fieldChips__buttons__repeatRound--active"),document.getElementById("buttonRepeatRound").classList.toggle("fieldChips__buttons__repeatRound")))),roundOver=!0}function sleep(e){return new Promise(t=>setTimeout(t,e))}